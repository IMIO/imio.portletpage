define("plone-patterns-portletmanager",["jquery","pat-base","mockup-utils","mockup-patterns-modal","translate","pat-logger","jquery.form"],function(i,t,r,n,s,e){"use strict";var l=e.getLogger("pat-manage-portlets");return t.extend({name:"manage-portlets",trigger:".pat-manage-portlets",parser:"mockup",messageTimeout:0,submitTimeout:0,switchTimeout:0,isModal:!1,dirty:!1,init:function(){var t=this,e=t.$el.parents(".plone-modal");1===e.size()?(this.isModal=!0,(e=e.data("pattern-plone-modal")).on("hide",function(){t.dirty&&window.location.reload()}),t.loading=e.loading):t.loading=r.loading,t.bind()},bind:function(){var n=this;n.setupAddDropdown(),n.setupSwitchPortletManager(),n.setupSavePortletsSettings(),n.setupPortletEdit(),n.isModal&&i(".portlets-link-to-parent").off("click").click(function(t){n.loading.show();var a=i(this);t.preventDefault(),i.ajax({url:a.attr("href"),data:{ajax_load:1}}).done(function(t){var e=i(r.parseBodyTag(t)),o=a.parents(".plone-modal-body");o.empty();t=i("#content",e),e=i("h1",t);i(".plone-modal-header",o.parent()).find("h2").html(e.html()),e.remove(),o.append(t),n.rebind(i(".pat-manage-portlets",t),!0),n.loading.hide()})})},rebind:function(t,e){l.info("rebind"),i.contains(document,this.$el[0])&&this.$el.replaceWith(t),this.$el=t,this.bind(),e||this.statusMessage(),this.dirty=!0},statusMessage:function(t){void 0===t&&(t=s("Portlet changes saved"));var e=this,o=i("#portlet-message");0===o.size()&&(o=i('<div class="portalMessage info" id="portlet-message" style="opacity: 0"></div>'),(e.isModal?i(".plone-modal-body:visible"):i("#content-core")).prepend(o)),o.html("<strong>"+s("Info")+"</strong>"+t),clearTimeout(e.messageTimeout),o.fadeTo(500,1),e.messageTimeout=window.setTimeout(function(){o.fadeTo(500,.6)},3e3)},showEditPortlet:function(t){l.info("show edit portlet in modal");var o=this,e=i("<a/>");i("body").append(e);var a=new n(e,{ajaxUrl:t,actionOptions:{displayInModal:!1,reloadWindowOnClose:!1,isForm:!0,onSuccess:function(t,e){a.hide();e=i(r.parseBodyTag(e));o.rebind(i("#"+o.$el.attr("id"),e).eq(0)),o.statusMessage(s("Portlet added"))}}});a.on("after-render",function(){var t=i("#"+o.$el.attr("id"),a.$raw);1===t.size()&&(t=t.clone(),a.on("shown",function(){a.hide()}),o.rebind(t),o.statusMessage(s("Portlet added")))}),a.show()},setupPortletEdit:function(){var e=this;i(".managedPortlet .portletHeader > a",e.$el).click(function(t){t.preventDefault(),e.showEditPortlet(i(this).attr("href"))})},setupAddDropdown:function(){var o=this;i(".add-portlet",o.$el).change(function(t){t.preventDefault();var e=i(this),t=e.parents("form"),t=e.attr("data-context-url")+e.val()+"?_authenticator="+i('[name="_authenticator"]').val()+"&referer="+i('[name="referer"]',t).val();o.showEditPortlet(t)})},setupSavePortletsSettings:function(){var e=this;i(".portlets-settings, form.portlet-action",e.$el).ajaxForm({beforeSubmit:function(){e.loading.show()},success:function(t){e.loading.hide(),l.info("form submit");t=i(r.parseBodyTag(t));e.rebind(i("#"+e.$el.attr("id"),t).eq(0))}}),i(".portlets-settings select",e.$el).change(function(){l.info("select change"),clearTimeout(e.submitTimeout),e.submitTimeout=window.setTimeout(function(){i(".portlets-settings",e.$el).submit()},100)})},setupSwitchPortletManager:function(){var o=this;i("#main-container").on("change",".switch-portlet-manager",function(t){t.stopImmediatePropagation(),l.info("switch portlet manager");var e=i(this).val();clearTimeout(o.switchTimeout),o.switchTimeout=window.setTimeout(function(){o._reloadPortletManager(e)},100)}),i(window).on("popstate",function(t){t.stopImmediatePropagation(),t&&void 0===t.state&&(t=window.location.href,l.info("redirecting to: "+t),o._reloadPortletManager(t,!0))})},_reloadPortletManager:function(e,o){var a=this;a.loading.show(),i.get(e,{ajax_load:1}).done(function(t){t=i(r.parseBodyTag(t));i("#content").html(t),a.rebind(i(".pat-manage-portlets",t),!0),o?window.history.replaceState(null,null,e):window.history.pushState(null,null,e),a.loading.hide()})}})}),require(["jquery","plone-patterns-portletmanager","mockup-patterns-modal","pat-registry","pat-logger"],function(n,t,i,e,o){"use strict";var r=o.getLogger("pat-manage-portlets");return delete e.patterns.manageporlets,delete n.fn.patManagePortlets,t.extend({name:"imio-manage-portlets",trigger:".pat-imio-manage-portlets",parser:"mockup",init:function(){t.prototype.init.call(this)},showEditPortlet:function(t){r.info("show edit portlet in modal");var o=this,e=n("<a/>");n("body").append(e);var a=new i(e,{ajaxUrl:t,buttons:'.formControls > input[type="submit"][name^="form.buttons"]',actionOptions:{displayInModal:!1,reloadWindowOnClose:!1,isForm:!0,onSuccess:function(t,e){a.hide();e=n(utils.parseBodyTag(e));o.rebind(n("#"+o.$el.attr("id"),e).eq(0)),o.statusMessage(_t("Portlet added"))}}});a.on("after-render",function(){var t=n("#"+o.$el.attr("id"),a.$raw);1===t.size()&&(t=t.clone(),a.on("shown",function(){a.hide()}),o.rebind(t),o.statusMessage(_t("Portlet added")))}),a.show()}}),t}),define("/Users/mpeeters/workspace/imio/imio.portletpage/src/imio/portletpage/browser/static/manage-portlet-pattern.js",function(){});
//# sourceMappingURL=imio.portletpage-compiled.min.js.map
